#! /bin/sh

check_for_disk_argument(){
    if [[ $1 != "--disk" && -z $2 ]]; then
        echo which disk, use this format:
        echo ./install --disk $2
        exit 1
    fi
}

check_if_disk_exists(){
    if [ ! -b "$2" ]; then
        echo $2 disk does not exit
        exit 1
    fi
}

partition_disk_10Gswap(){
    echo $1
    echo $2
(
    echo g # Create a new empty partition table
    echo n # Add a new partition
    echo 1 # Partition number
    echo   # First sector (Accept default: 1)
    echo +512M # size of partition
    echo n # Add a new partition
    echo 2 # Partition number
    echo   # First sector (Accept default: 1)
    echo +10G # size of partition
    echo n # Add a new partition
    echo 3 # Partition number
    echo   # First sector (Accept default: 1)
    echo   # size of partition (Accept default: 1)
    echo t # set type of partition 
    echo 1 # select partition 1
    echo 1 # set type to efi partition 

    echo w # Write changes
    ) | fdisk $2
}

check_for_disk_argument
check_if_disk_exists
timedatectl set-ntp true
partition_disk_10Gswap $2

###partition drive
#

###Format drive partittions
#
echo creating file formats
mkfs.vfat -F32 $21
mkswap $22
swapon $22
mkfs.ext4 $23


##Mount partitons
echo Mounting partitions
mount $23 /mnt
mkdir /mnt/boot
mkdir /mnt/boot/efi
mount $21 /mnt/boot/efi

##pacstrap
## Norway
echo "Server = http://mirror.neuf.no/archlinux/\$repo/os/\$arch" | cat - /etc/pacman.d/mirrorlist > temp && mv temp /etc/pacman.d/mirrorlist
pacstrap /mnt base base-devel vim

##GenfsTab
genfstab -U /mnt >> /mnt/etc/fstab

##copy script part 2 into /mnt
cp part2 /mnt/part2

arch-chroot /mnt ./part2

